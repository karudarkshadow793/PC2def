networks:
  cdps-net:
    driver: bridge

services:
  productpage:
    image: cdps-productpage:g29
    container_name: productpage_cdps_29
    ports: ["9080:9080"]
    environment:
      - DETAILS_HOSTNAME=details-service
      - RATINGS_HOSTNAME=ratings-service
      - REVIEWS_HOSTNAME=reviews-service
    volumes:
      - ./bookinfo/src/productpage:/app
    networks: [cdps-net]
    depends_on: [details, reviews, ratings]

  details:
    image: cdps-details:g29
    container_name: details_cdps_29
    ports: ["7070:7070"]
    environment:
      - ENABLE_EXTERNAL_BOOK_SERVICE=true
    volumes:
      - ./bookinfo/src/details:/opt/microservices
    networks: [cdps-net]

  ratings:
    image: cdps-ratings:g29
    container_name: ratings_cdps_29
    ports: ["9082:9080"]
    environment:
      - APP_VERSION=v1
    volumes:
      - ./bookinfo/src/ratings:/opt/microservices
      - /opt/microservices/node_modules
    networks: [cdps-net]

  reviews:
    image: cdps-reviews:${REVIEWS_VERSION:-v1}-g29
    container_name: reviews_cdps_29
    ports: ["9081:9080"]
    environment:
      - SERVICE_VERSION=${REVIEWS_VERSION:-v1}
      - ENABLE_RATINGS=true
      - APP_VERSION=${REVIEWS_APP_VERSION:-v1}
      - STAR_COLOR=${REVIEWS_STAR_COLOR:-black}
    volumes:
      - ./bookinfo/src/ratings:/opt/microservices
      - /opt/microservices/node_modules

    networks: [cdps-net]
